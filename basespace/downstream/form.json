{
    "$type": "Form",
    "fields": [
        {
            "$type": "TextBox",
            "size": 500,
            "minLength": 0,
            "maxLength": 150,
            "value": "QIIME Downstream [LocalDateTime]",
            "label": "Analysis Name",
            "required": true,
            "requiredMessage": "Please enter name for your app session.",
            "id": "app-session-name",
            "helpText": "The analysis name you want to use in BaseSpace"
        },
        {
            "$type": "TextBox",
            "size": 500,
            "minLength": 30,
            "maxLength": 150,
            "value": "",
            "label": "Google key where your mapping file is located",
            "required": true,
            "requiredMessage": "Please enter the key of your mapping file see http://qiime.org/tutorials/remote_mapping_files.html#prerequisites for help",
            "id": "spreadsheet-key",
            "helpText": "The spreadsheet key to your QIIME mapping stored in a Google Spreadsheet (File > Publish to the Web > Publish; in the URL, it's the 44 digit string between 'd/' and '/pubhtml'). For more examples, see http://qiime.org/tutorials/remote_mapping_files.html and for more information on how to create a QIIME mapping file, see: http://qiime.org/documentation/file_formats.html#metadata-mapping-files",
            "rules": "is-valid-google-key"
        },
        {
          "$type": "Numeric",
          "id": "rarefaction-depth",
          "size": 100,
          "required": true,
          "label": "Even rarefaction depth",
          "min": 1,
          "value": 0,
          "numericType": "Integer",
          "helpText": "Number of sequences to subsample per sample. Selecting this value heavily depends on the distributon of sequences per sample in your OTU table, thus we recommend that after looking at the OTU table summary, you select a value that best represents your study, and your hypothesis"
        },
        {
            "$type": "Numeric",
            "id": "number-of-jobs",
            "size": 100,
            "required": true,
            "label": "Number of parallel jobs for diversity analyses (up to 31)",
            "min": 1,
            "max": 31,
            "value": 31,
            "numericType": "Integer",
            "helpText": "Depending on the number of samples you are processing, you may want to use more or fewer cores. More cores usually mean a faster processing time, but be aware that there's overhead associated with parallel processing, so more cores not alwasy means a faster processing time."
        },
        {
            "$type": "AppResultChooser",
            "size": 500,
            "valueType": "Input",
            "multiselect": "false",
            "label": "QIIME Preprocessing Results (OTU Picking output i.e. a folder named closed-ref)",
            "required": true,
            "requiredMessage": "Please choose an app result generated by 'QIIME Upstream'",
            "id": "app-result-id",
            "helpText": "Output as generated by the QIIME Upstream app - will only use the OTU table"
        },
        {
            "$type": "SectionBreak"
        },
        {
            "$type": "ProjectChooser",
            "size": 500,
            "valueType": "Output",
            "allowedPermissions": "owner",
            "label": "Save Results To",
            "required": true,
            "requiredMessage": "Please choose a project",
            "id": "project-id",
            "allowResourceCreation": true,
            "rules": "is-project-owner",
            "helpText": "The BaseSpace project where you want to store your results"
        }
    ],
    "rulesets":[
        {
            "$type": "PermissionValidationRule",
            "permissions": "Read",
            "severity": "Error",
            "message": "You do not have read access to the selected sample",
            "id": "sample-reader"
        },
        {
            "$type": "PermissionValidationRule",
            "permissions": "Own",
            "severity": "Error",
            "message": "You aren't the owner of the selected project.",
            "id": "is-project-owner"
        },
        {
            "$type": "ScriptValidationRule",
            "callback": "
                var url = dataProvider.GetProperty(\"Input.spreadsheet-key\");
                var parts;
                var key = '';
                    
                parts = url.split('/');
                
                // perform vald333d00zl3
                if (parts.length === 7 && parts[ 0] === 'https:'){
                    key = parts[5];
                }
                else{
                    key = parts[0];
                }
                
                // couldn't find any documentation, but it seems like all keys
                // are 44 characters long, or at least the ones I checked
                if (key.length === 44){
                    return null
                }
                else{
                    return {Message: 'This is not a valid spreadsheet keey, please revise the documentation in this tutorial: http://qiime.org/tutorials/remote_mapping_files.html'};
                }
                ",
            "id": "is-valid-google-key"
        },
    ]
}